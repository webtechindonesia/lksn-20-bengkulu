<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        .container{
            margin-top: 100px;
            margin-left: auto;
            margin-right: auto;
            width: 1000px;
        }
        .flex{
            display: flex;
            
        }
        .justify-beetwen{
            justify-content: space-between;
        }
        .justify-center{
            justify-content: center;
        }
        body{
            background-color: #34495e;
        }
        h3,h1{
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="flex justify-beetwen">
            <div>
                <h3>Score</h3>
                <h3 id="score">0</h3>
            </div>
            <div>
                <h1>PYTHONS</h1>
            </div>
            <div>
                <h3>Time</h3>
                <h3 id="time">0 : 00 : 00</h3>
            </div>
        </div>
        <div class="flex justify-center canvas">
            <canvas id="canvas" width="960" height="600"></canvas>
            <script>
                var canvas = document.getElementById('canvas')
                var context = canvas.getContext('2d');
                var width_board = canvas.scrollWidth
                var height_board = canvas.scrollHeight
                var ukuran_kotak = 20;
                var klik;
                var makanan;
                var makanan1;
                var makanan2;
                var nilai;
                var waktu = 0;
                var detik= 0;
                var batas_detik = 4;
                var jam = 3600;
                var minute = 60;
                context.fillStyle='green';
                    context.fillRect(0,0,width_board,height_board);
                 function mulai(){
                     klik = "kanan"
                     create_python()
                     makanan = create_makanan()
                     makanan1 = create_makanan()
                     makanan2 = create_makanan()
                     nilai = 0
                     if(typeof loop != 'undefined')clearInterval(loop);
                     loop = setInterval(gambar,1000/4)
                 }


                 function create_python(){
                     var cell_badan = 6;
                     badan = []

                     for(i = cell_badan - 1; i >= 0; i--){
                        badan.push({x:i,y:0})
                     }
                 }

                 function create_makanan(){
                     return {
                         x: Math.round(Math.random() * (width_board - ukuran_kotak) / ukuran_kotak),
                         y: Math.round(Math.random() * (height_board - ukuran_kotak) / ukuran_kotak)
                     }
                 }

                 function gambar(){
                    context.fillStyle='green';
                    context.fillRect(0,0,width_board,height_board);
                     var nx = badan[0].x
                     var ny = badan[0].y
                     if (klik == "kanan") nx++;
                        else if (klik == "kiri") nx--;
                        else if (klik == "atas") ny--;
                        else if (klik == "bawah") ny++;
                        if(
                            cek_tabrakan(nx,ny,badan)

                        ){
                            mulai()
                            return 
                        }else if(nx == -1){
                            nx = width_board / ukuran_kotak
                        }else if(                          
                            nx == width_board / ukuran_kotak
                        ){
                            nx = 0
                        }else if(ny == -1 ){
                            ny = height_board / ukuran_kotak
                        }else if(ny == height_board / ukuran_kotak){
                            ny = 0
                        }

                        if(nx == makanan.x && ny==makanan.y){
                            var tambah_badan = {x:nx,y:ny}
                            nilai++
                            makanan = create_makanan()
                        }else if(nx == makanan1.x && ny==makanan1.y ){
                            var tambah_badan = {x:nx,y:ny}
                            nilai++
                            makanan1 = create_makanan()
                        }else if(nx == makanan2.x && ny==makanan2.y){
                            var tambah_badan = {x:nx,y:ny}
                            nilai++
                            makanan2 = create_makanan()
                        }else{
                            var tambah_badan = badan.pop()
                            tambah_badan.x = nx
                            tambah_badan.y = ny
                        }
                        badan.unshift(tambah_badan)

                        for(i=0;i<badan.length;i++){
                            var c = badan[i]
                            gambar_badan(c.x,c.y)
                        }
                        detik++
                        if(detik == batas_detik){
                            batas_detik += 4
                            waktu++
                        }
                        
                        gambar_badan(makanan.x,makanan.y)
                        gambar_badan(makanan1.x,makanan1.y)
                        gambar_badan(makanan2.x,makanan2.y)
                        document.getElementById('score').innerHTML = nilai
                        minute = Math.floor(waktu / 60);
                        jam = Math.floor(waktu / 3600);
                        let seconds = waktu - minute * 60;
                        waktu = waktu - jam * 3600;
                        document.getElementById('time').innerHTML = jam + ' : ' + (minute < 10 ? '0' + minute : minute) + ' : ' + (seconds < 10 ? '0' + seconds : seconds)
                 }

                 function gambar_badan(x,y){
                     context.fillStyle='blue';
                     context.fillRect(x*ukuran_kotak,y*ukuran_kotak,ukuran_kotak,ukuran_kotak)
                     context.strokeStyle='white';
                     context.strokeRect(x*ukuran_kotak,y*ukuran_kotak,ukuran_kotak,ukuran_kotak);
                 }

                 function cek_tabrakan(x,y,array){
                    for (var i = 0; i < array.length; i++) {
                        if (array[i].x == x && array[i].y == y) return true;
                    }
                    return false;
                 }

                 document.addEventListener('keydown',function(e){
                     var keyboard = e.which
                     if(keyboard == "37" && klik != "kanan") klik = "kiri";
                        else if(keyboard == "38" && klik != "bawah") klik = "atas";
                        else if(keyboard == "39" && klik != "kiri") klik = "kanan";
                        else if(keyboard == "40" && klik != "atas") klik = "bawah";

                 })

                var alert_o = window.alert('mulai')
                mulai()
            </script>
        </div>
    </div>
</body>
</html>